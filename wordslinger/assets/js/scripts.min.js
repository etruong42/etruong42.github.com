var requirejs,require,define;(function(Y){function I(e){return"[object Function]"===L.call(e)}function J(e){return"[object Array]"===L.call(e)}function x(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function M(e,t){if(e){var n;for(n=e.length-1;-1<n&&(!e[n]||!t(e[n],n,e));n-=1);}}function r(e,t){return da.call(e,t)}function i(e,t){return r(e,t)&&e[t]}function E(e,t){for(var n in e)if(r(e,n)&&t(e[n],n))break}function Q(e,t,n,i){return t&&E(t,function(t,s){if(n||!r(e,s))i&&"string"!=typeof t?(e[s]||(e[s]={}),Q(e[s],t,n,i)):e[s]=t}),e}function t(e,t){return function(){return t.apply(e,arguments)}}function Z(e){if(!e)return e;var t=Y;return x(e.split("."),function(e){t=t[e]}),t}function F(e,t,n,r){return t=Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e),t.requireType=e,t.requireModules=r,n&&(t.originalError=n),t}function ea(e){function n(e,t,n){var r,s,o,u,a,f,l,c=t&&t.split("/");r=c;var h=C.map,p=h&&h["*"];if(e&&"."===e.charAt(0))if(t){r=i(C.pkgs,t)?c=[t]:c.slice(0,c.length-1),t=e=r.concat(e.split("/"));for(r=0;t[r];r+=1)if(s=t[r],"."===s)t.splice(r,1),r-=1;else if(".."===s){if(1===r&&(".."===t[2]||".."===t[0]))break;0<r&&(t.splice(r-1,2),r-=2)}r=i(C.pkgs,t=e[0]),e=e.join("/"),r&&e===t+"/"+r.main&&(e=t)}else 0===e.indexOf("./")&&(e=e.substring(2));if(n&&(c||p)&&h){t=e.split("/");for(r=t.length;0<r;r-=1){o=t.slice(0,r).join("/");if(c)for(s=c.length;0<s;s-=1)if(n=i(h,c.slice(0,s).join("/")))if(n=i(n,o)){u=n,a=r;break}if(u)break;!f&&p&&i(p,o)&&(f=i(p,o),l=r)}!u&&f&&(u=f,a=l),u&&(t.splice(0,a,u),e=t.join("/"))}return e}function s(e){z&&x(document.getElementsByTagName("script"),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===S.contextName)return t.parentNode.removeChild(t),!0})}function o(e){var t=i(C.paths,e);if(t&&J(t)&&1<t.length)return s(e),t.shift(),S.require.undef(e),S.require([e]),!0}function u(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function a(e,t,r,s){var o,a,f=null,l=t?t.name:null,c=e,h=!0,p="";return e||(h=!1,e="_@r"+(D+=1)),e=u(e),f=e[0],e=e[1],f&&(f=n(f,l,s),a=i(M,f)),e&&(f?p=a&&a.normalize?a.normalize(e,function(e){return n(e,l,s)}):n(e,l,s):(p=n(e,l,s),e=u(p),f=e[0],p=e[1],r=!0,o=S.nameToUrl(p))),r=f&&!a&&!r?"_unnormalized"+(H+=1):"",{prefix:f,name:p,parentMap:t,unnormalized:!!r,url:o,originalName:c,isDefine:h,id:(f?f+"!"+p:p)+r}}function f(e){var t=e.id,n=i(k,t);return n||(n=k[t]=new S.Module(e)),n}function c(e,t,n){var s=e.id,o=i(k,s);r(M,s)&&(!o||o.defineEmitComplete)?"defined"===t&&n(M[s]):f(e).on(t,n)}function h(e,t){var n=e.requireModules,r=!1;t?t(e):(x(n,function(t){if(t=i(k,t))t.error=e,t.events.error&&(r=!0,t.emit("error",e))}),!r)&&l.onError(e)}function p(){R.length&&(fa.apply(A,[A.length-1,0].concat(R)),R=[])}function d(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,x(e.depMaps,function(r,s){var o=r.id,u=i(k,o);u&&!e.depMatched[s]&&!n[o]&&(i(t,o)?(e.defineDep(s,M[o]),e.check()):d(u,t,n))}),n[r]=!0)}function v(){var e,t,n,r,i=(n=1e3*C.waitSeconds)&&S.startTime+n<(new Date).getTime(),u=[],a=[],f=!1,l=!0;if(!b){b=!0,E(k,function(n){e=n.map,t=e.id;if(n.enabled&&(e.isDefine||a.push(n),!n.error))if(!n.inited&&i)o(t)?f=r=!0:(u.push(t),s(t));else if(!n.inited&&n.fetched&&e.isDefine&&(f=!0,!e.prefix))return l=!1});if(i&&u.length)return n=F("timeout","Load timeout for modules: "+u,null,u),n.contextName=S.contextName,h(n);l&&x(a,function(e){d(e,{},{})}),(!i||r)&&f&&(z||$)&&!N&&(N=setTimeout(function(){N=0,v()},50)),b=!1}}function m(e){r(M,e[0])||f(a(e[0],null,!0)).init(e[1],e[2])}function g(e){var e=e.currentTarget||e.srcElement,t=S.onScriptLoad;return e.detachEvent&&!V?e.detachEvent("onreadystatechange",t):e.removeEventListener("load",t,!1),t=S.onScriptError,(!e.detachEvent||V)&&e.removeEventListener("error",t,!1),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function y(){var e;for(p();A.length;){e=A.shift();if(null===e[0])return h(F("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));m(e)}}var b,w,S,T,N,C={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},map:{},config:{}},k={},L={},A=[],M={},_={},D=1,H=1;return T={require:function(e){return e.require?e.require:e.require=S.makeRequire(e.map)},exports:function(e){e.usingExports=!0;if(e.map.isDefine)return e.exports?e.exports:e.exports=M[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return C.config&&i(C.config,e.map.id)||{}},exports:M[e.map.id]}}},w=function(e){this.events=i(L,e.id)||{},this.map=e,this.shim=i(C.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},w.prototype={init:function(e,n,r,i){i=i||{},this.inited||(this.factory=n,r?this.on("error",r):this.events.error&&(r=t(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=r,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,S.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();S.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],t(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;_[e]||(_[e]=!0,S.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id;t=this.depExports;var r=this.exports,i=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(I(i)){if(this.events.error)try{r=S.execCb(n,i,t,r)}catch(s){e=s}else r=S.execCb(n,i,t,r);this.map.isDefine&&((t=this.module)&&void 0!==t.exports&&t.exports!==this.exports?r=t.exports:void 0===r&&this.usingExports&&(r=this.exports));if(e)return e.requireMap=this.map,e.requireModules=[this.map.id],e.requireType="define",h(this.error=e)}else r=i;this.exports=r,this.map.isDefine&&!this.ignore&&(M[n]=r,l.onResourceLoad)&&l.onResourceLoad(S,this.map,this.depMaps),delete k[n],this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,s=e.id,o=a(e.prefix);this.depMaps.push(o),c(o,"defined",t(this,function(o){var u,p;p=this.map.name;var d=this.map.parentMap?this.map.parentMap.name:null,v=S.makeRequire(e.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(o.normalize&&(p=o.normalize(p,function(e){return n(e,d,!0)})||""),o=a(e.prefix+"!"+p,this.map.parentMap),c(o,"defined",t(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),p=i(k,o.id))this.depMaps.push(o),this.events.error&&p.on("error",t(this,function(e){this.emit("error",e)})),p.enable()}else u=t(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),u.error=t(this,function(e){this.inited=!0,this.error=e,e.requireModules=[s],E(k,function(e){0===e.map.id.indexOf(s+"_unnormalized")&&delete k[e.map.id]}),h(e)}),u.fromText=t(this,function(t,n){var i=e.name,o=a(i),c=O;n&&(t=n),c&&(O=!1),f(o),r(C.config,s)&&(C.config[i]=C.config[s]);try{l.exec(t)}catch(p){return h(F("fromtexteval","fromText eval for "+s+" failed: "+p,p,[s]))}c&&(O=!0),this.depMaps.push(o),S.completeLoad(i),v([i],u)}),o.load(e.name,v,u,C)})),S.enable(o,this),this.pluginMaps[o.id]=o},enable:function(){this.enabling=this.enabled=!0,x(this.depMaps,t(this,function(e,n){var s,o;if("string"==typeof e){e=a(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[n]=e;if(s=i(T,e.id)){this.depExports[n]=s(this);return}this.depCount+=1,c(e,"defined",t(this,function(e){this.defineDep(n,e),this.check()})),this.errback&&c(e,"error",this.errback)}s=e.id,o=k[s],!r(T,s)&&o&&!o.enabled&&S.enable(e,this)})),E(this.pluginMaps,t(this,function(e){var t=i(k,e.id);t&&!t.enabled&&S.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){x(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},S={config:C,contextName:e,registry:k,defined:M,urlFetched:_,defQueue:A,Module:w,makeModuleMap:a,nextTick:l.nextTick,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=C.pkgs,n=C.shim,r={paths:!0,config:!0,map:!0};E(e,function(e,t){r[t]?"map"===t?Q(C[t],e,!0,!0):Q(C[t],e,!0):C[t]=e}),e.shim&&(E(e.shim,function(e,t){J(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=S.makeShimExports(e)),n[t]=e}),C.shim=n),e.packages&&(x(e.packages,function(e){e="string"==typeof e?{name:e}:e,t[e.name]={name:e.name,location:e.location||e.name,main:(e.main||"main").replace(ga,"").replace(aa,"")}}),C.pkgs=t),E(k,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=a(t))}),(e.deps||e.callback)&&S.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(Y,arguments)),t||e.exports&&Z(e.exports)}},makeRequire:function(t,s){function o(n,i,u){var c,p;return s.enableBuildCallback&&i&&I(i)&&(i.__requireJsBuild=!0),"string"==typeof n?I(i)?h(F("requireargs","Invalid require call"),u):t&&r(T,n)?T[n](k[t.id]):l.get?l.get(S,n,t):(c=a(n,t,!1,!0),c=c.id,r(M,c)?M[c]:h(F("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(y(),S.nextTick(function(){y(),p=f(a(null,t)),p.skipMap=s.skipMap,p.init(n,i,u,{enabled:!0}),v()}),o)}return s=s||{},Q(o,{isBrowser:z,toUrl:function(e){var r,i=e.lastIndexOf("."),s=e.split("/")[0];return-1!==i&&("."!==s&&".."!==s||1<i)&&(r=e.substring(i,e.length),e=e.substring(0,i)),e=S.nameToUrl(n(e,t&&t.id,!0),r||".fake"),r?e:e.substring(0,e.length-5)},defined:function(e){return r(M,a(e,t,!1,!0).id)},specified:function(e){return e=a(e,t,!1,!0).id,r(M,e)||r(k,e)}}),t||(o.undef=function(e){p();var n=a(e,t,!0),r=i(k,e);delete M[e],delete _[n.url],delete L[e],r&&(r.events.defined&&(L[e]=r.events),delete k[e])}),o},enable:function(e){i(k,e.id)&&f(e).enable()},completeLoad:function(e){var t,n,s=i(C.shim,e)||{},u=s.exports;for(p();A.length;){n=A.shift();if(null===n[0]){n[0]=e;if(t)break;t=!0}else n[0]===e&&(t=!0);m(n)}n=i(k,e);if(!t&&!r(M,e)&&n&&!n.inited){if(C.enforceDefine&&(!u||!Z(u)))return o(e)?void 0:h(F("nodefine","No define call for "+e,null,[e]));m([e,s.deps||[],s.exportsFn])}v()},nameToUrl:function(e,t){var n,r,s,o,u,a;if(l.jsExtRegExp.test(e))o=e+(t||"");else{n=C.paths,r=C.pkgs,o=e.split("/");for(u=o.length;0<u;u-=1){if(a=o.slice(0,u).join("/"),s=i(r,a),a=i(n,a)){J(a)&&(a=a[0]),o.splice(0,u,a);break}if(s){n=e===s.name?s.location+"/"+s.main:s.location,o.splice(0,u,n);break}}o=o.join("/"),o+=t||(/\?/.test(o)?"":".js"),o=("/"===o.charAt(0)||o.match(/^[\w\+\.\-]+:/)?"":C.baseUrl)+o}return C.urlArgs?o+((-1===o.indexOf("?")?"?":"&")+C.urlArgs):o},load:function(e,t){l.load(S,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if("load"===e.type||ha.test((e.currentTarget||e.srcElement).readyState))P=null,e=g(e),S.completeLoad(e.id)},onScriptError:function(e){var t=g(e);if(!o(t.id))return h(F("scripterror","Script error",e,[t.id]))}},S.require=S.makeRequire(),S}var l,w,B,D,s,H,P,K,ba,ca,ia=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,ja=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,aa=/\.js$/,ga=/^\.\//;w=Object.prototype;var L=w.toString,da=w.hasOwnProperty,fa=Array.prototype.splice,z="undefined"!=typeof window&&!!navigator&&!!document,$=!z&&"undefined"!=typeof importScripts,ha=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,V="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),C={},q={},R=[],O=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(I(requirejs))return;q=requirejs,requirejs=void 0}"undefined"!=typeof require&&!I(require)&&(q=require,require=void 0),l=requirejs=function(e,t,n,r){var s,o="_";return!J(e)&&"string"!=typeof e&&(s=e,J(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),(r=i(C,o))||(r=C[o]=l.s.newContext(o)),s&&r.configure(s),r.require(e,t,n)},l.config=function(e){return l(e)},l.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=l),l.version="2.1.4",l.jsExtRegExp=/^\/|:|\?|\.js$/,l.isBrowser=z,w=l.s={contexts:C,newContext:ea},l({}),x(["toUrl","undef","defined","specified"],function(e){l[e]=function(){var t=C._;return t.require[e].apply(t,arguments)}}),z&&(B=w.head=document.getElementsByTagName("head")[0],D=document.getElementsByTagName("base")[0])&&(B=w.head=D.parentNode),l.onError=function(e){throw e},l.load=function(e,t,n){var r=e&&e.config||{},i;if(z)return i=r.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),i.type=r.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),i.attachEvent&&!(i.attachEvent.toString&&0>i.attachEvent.toString().indexOf("[native code"))&&!V?(O=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)):(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)),i.src=n,K=i,D?B.insertBefore(i,D):B.appendChild(i),K=null,i;$&&(importScripts(n),e.completeLoad(t))},z&&M(document.getElementsByTagName("script"),function(e){B||(B=e.parentNode);if(s=e.getAttribute("data-main"))return q.baseUrl||(H=s.split("/"),ba=H.pop(),ca=H.length?H.join("/")+"/":"./",q.baseUrl=ca,s=ba),s=s.replace(aa,""),q.deps=q.deps?q.deps.concat(s):[s],!0}),define=function(e,t,n){var r,i;"string"!=typeof e&&(n=t,t=e,e=null),J(t)||(n=t,t=[]),!t.length&&I(n)&&n.length&&(n.toString().replace(ia,"").replace(ja,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t)),O&&((r=K)||(P&&"interactive"===P.readyState||M(document.getElementsByTagName("script"),function(e){if("interactive"===e.readyState)return P=e}),r=P),r&&(e||(e=r.getAttribute("data-requiremodule")),i=C[r.getAttribute("data-requirecontext")])),(i?i.defQueue:R).push([e,t,n])},define.amd={jQuery:!0},l.exec=function(b){return eval(b)},l(q)}})(this),define("requireLib",function(){}),define("models/Move",[],function(){var e=Backbone.Collection.extend({events:{add:"logChange",remove:"logChange"},logChange:function(){console.log(this.models.map(function(e){return e.toJSON().letter}))},initialize:function(e){this.on("add",this.logChange,this)},addTile:function(e){this.removeTile(e),this.push(e)},removeTile:function(e){this.remove(this.filter(function(t){return t.cid===e.cid}))},getTotalScore:function(){var e=[],t=[],n=this.getOrientation();if(!n)return null;this.sort();var r,i;n==="vert"&&(r="y",i="x"),n==="hori"&&(r="x",i="y");var s=this.at(0);if(!s)return 0;var o=s.get("position")[r],u=s.get("position")[i],a=!0,f=0,l=[],c=0,h=null,p=this.board.getTilesOnAxis(i,u),d=o-1,v=function(e){return e.get("position")[r]===d};while(a){if(d>-1){var m=_.find(p,v);if(m){f+=m.get("points"),d--;continue}}a=!1}var g,y;for(y=0;y<this.length;y++){g=this.at(y);var b;if(!h)h=g.get("position")[r];else if(h!==g.get("position")[r]-1)return null;h=g.get("position")[r];var w=null;for(var E in this.board.modifiedTiles)_.any(this.board.modifiedTiles[E],g.positionMatch,g)&&(w=this.board.tileModifiers[E],this.board.scoreModifiers[E]&&(b=this.board.scoreModifiers[E],l.push(this.board.scoreModifiers[E])));var S=!0,x=!0,T,N,C,k=!1,L=0;N=u-1;while(S)N>-1&&(T={},T[i]=N,T[r]=h,C=this.board.getTileAt(T),C?(k||(w?L+=w(g):L+=g.get("points"),k=!0),L+=C.get("points"),N--):S=!1);N=u+1;while(x)N<=15&&(T={},T[i]=N,T[r]=h,C=this.board.getTileAt(T),C?(k||(w?L+=w(g):L+=g.get("points"),k=!0),L+=C.get("points"),N++):x=!1);b?c+=b(L):c+=L,w?f+=w(g):f+=g.get("points")}var A=!0,O=o+1;v=function(e){return e.get("position")[r]===O};while(A){if(O>-1){var M=_.find(p,v);if(M){f+=M.get("points"),O++;continue}}A=!1}for(var D=0;D<l.length;D++)f=l[D](f);return f+c},getOrientation:function(){var e=this.map(function(e){return e.get("position").x});return _.every(e,function(t){return t==e[0]})?(this.comparator=function(e){return e.get("position").y},"vert"):(e=this.map(function(e){return e.get("position").y}),_.every(e,function(t){return t==e[0]})?(this.comparator=function(e){return e.get("position").x},"hori"):null)}});return e}),define("views/EndTurnView",[],function(){var e=Backbone.View.extend({tagName:"input",className:"endTurn",initialize:function(e){this.game=e.game,this.$el.attr("type","button"),this.$el.attr("value","Play Turn")},events:{click:"endTurn"},endTurn:function(){this.game.endCurrentTurn()}});return e}),define("models/WordslingerGame",["models/Move","views/EndTurnView"],function(e,t){var n=Backbone.Model.extend({initialize:function(e){this.board=e.board,this.grabbag=e.grabbag,this.set("currentHandIndex",0),this.set("handsize",7),this.initMove(),_.each(this.board.get("hands"),this.initHand,this),this.initBoard(this.board);var n=new t({game:this});n.$el.appendTo("div.players")},initMove:function(){this.currentMove=new e,this.currentMove.board=this.board},initHand:function(e){e.on("tile:handslotmove",this.removeTileFromCurrentMove,this)},initBoard:function(e){e.on("tile:boardslotmove",this.addTileToCurrentMove,this)},startGame:function(){this.board.startGame()},setActiveTile:function(e){this.activeTile=e},addTileToCurrentMove:function(e){this.currentMove.addTile(e),this.board.getActiveHand().updateCurrentMoveScore(this.currentMove.getTotalScore())},removeTileFromCurrentMove:function(e){this.currentMove.removeTile(e),this.board.getActiveHand().updateCurrentMoveScore(this.currentMove.getTotalScore())},endCurrentTurn:function(){var e=this.currentMove.getTotalScore();if(!e)return;this.board.getActiveHand().updateCurrentMoveScore(0).endTurn(this.currentMove.models).grabTiles(this.grabbag,this.currentMove.models.length).handView.render(),this.board.addMove(this.currentMove);var t=$(this.board.getActiveHand().handView.$el.parent()).find(".handscore"),n=parseInt(t.html(),10);n||(n=0),n+=e,t.html(n),this.initMove(),this.board.nextHand()}});return n}),define("models/Board",[],function(){var e=Backbone.Model.extend({defaults:{moves:[],tiles:[],tileslots:[]},startGame:function(){_.each(this.get("hands"),this.initHand,this),this._activeHandIndex=0,this.initActiveHand()},initActiveHand:function(){var e=this.getActiveHand();e.on("tile:select",e.selectTile,e),e.forEach(function(e){window.a=e,e.setDraggability(!0)})},disableActiveHand:function(){var e=this.getActiveHand();e.off("tile:select",e.selectTile,e),e.forEach(function(e){e.setDraggability(!1)}),e.selectedTile=null},initHand:function(e){e.grabTiles(this.get("grabbag"),7),e.handView.render()},initialize:function(e){this.hands=e.hands,this.tileslots=[]},getActiveHand:function(){return this.hands[this._activeHandIndex]},addMove:function(e){_.each(e.models,function(e){this.get("tiles").push(e)},this)},nextHand:function(){this.disableActiveHand(),this._activeHandIndex++,this._activeHandIndex==this.hands.length&&(this._activeHandIndex=0),this.initActiveHand()},getTilesOnAxis:function(e,t){return _.filter(this.get("tiles"),function(n){return n.get("position")[e]===t})},getTileAt:function(e){var t=_.filter(this.get("tiles"),function(t){return t.get("position").x===e.x&&t.get("position").y===e.y});if(t)return t[0]},tileModifiers:{TL:function(e){return e.get("points")*3},DL:function(e){return e.get("points")*2}},scoreModifiers:{DW:function(e,t){return e*2},TW:function(e,t){return e*3}},modifiedTiles:{TW:[[0,0],[0,7],[0,14],[7,0],[14,0],[14,7],[14,14],[7,14]],DW:[[1,1],[2,2],[3,3],[4,4],[7,7],[10,10],[11,11],[12,12],[13,13],[1,13],[2,12],[3,11],[4,10],[10,4],[11,3],[12,2],[13,1]],TL:[[5,1],[5,5],[5,9],[5,13],[9,1],[9,5],[9,9],[9,13],[1,5],[1,9],[13,5],[13,9]],DL:[[0,3],[0,11],[2,6],[2,8],[3,0],[3,7],[3,14],[6,2],[6,6],[6,8],[6,12],[7,3],[7,11],[8,2],[8,6],[8,8],[8,12],[14,3],[14,11],[12,6],[12,8],[11,0],[11,7],[11,14]]}});return e}),define("views/TileSlotView",[],function(){var e=Backbone.View.extend({tagName:"div",className:"tileSlot",initialize:function(e){this.board=e.board},render:function(){return this},events:{click:"placeTile","dblclick .selected.tile":"returnTileEvent",drop:"dropTile"},placeTile:function(){var e=this.board.getActiveHand().selectedTile;e&&(this.$el.append(e.tileView.$el.attr("style",null)),e.set({position:{x:this.model.x,y:this.model.y}}),this.board.trigger("tile:boardslotmove",e))},dropTile:function(e,t){if(!this.$el.is(":empty")){t.draggable.animate({left:0,top:0},500);return}this.placeTile()},returnTileEvent:function(e){this.returnTile(e.currentTarget)},returnTile:function(e){this.board.getActiveHand().handView.getFirstEmpty().append(e),this.board.getActiveHand().trigger("tile:handslotmove",this.board.getActiveHand().selectedTile)}});return e}),define("models/TileSlot",["views/TileSlotView"],function(e){var t=Backbone.Model.extend({defaults:{scoreModifier:null,tileModifier:null},initialize:function(t){this.tileSlotView=new e({model:this,board:t.board}),t.board.tileslots[t.x]||(t.board.tileslots[t.x]=[]),t.board.tileslots[t.x][t.y]=this,this.x=t.x,this.y=t.y,modifierTileEquals=function(e){return e[0]==t.x&&e[1]==t.y};for(var n in t.board.modifiedTiles){window.a=n;var r=t.board.modifiedTiles[n];_.any(r,modifierTileEquals)&&(this.set({tileModifier:t.board.tileModifiers[n]}),this.set({scoreModifier:t.board.scoreModifiers[n]}),this.tileSlotView.$el.addClass(n))}}});return t}),define("views/BoardView",["models/TileSlot"],function(e){var t=Backbone.View.extend({tagName:"div",className:"board",render:function(){return 0},generateRow:function(t,n){for(var r=0;r<t;r++){var i=new e({x:r,y:n,board:this.model});this.$el.append(i.tileSlotView.el),i.tileSlotView.$el.droppable({accept:".tile",tolerance:"pointer",addClasses:!1})}},initialize:function(e){this.width=e.width,this.height=e.height,this.$el=e.$el,this.$el.width(this.width*38),this.$el.height(this.height*38);for(var t=0;t<this.height;t++)this.generateRow(this.width,t)}});return t}),define("jst",[],function(){var e={};return e.tile=_.template(["<div class='tile-letter'><%= letter %></div>","<div class='tile-points'><%= points %></div>"].join("")),e}),define("views/TileView",["jst"],function(e){var t=Backbone.View.extend({tagName:"span",className:"tile",events:{mousedown:"onClick"},onClick:function(){this.model.trigger("tile:select",this.model)},initialize:function(t){this.template=e.tile,this.$el.html(this.template(this.model.toJSON()))},select:function(){this.$el.addClass("selected")},unselect:function(){this.$el.removeClass("selected")}});return t}),define("models/Tile",["views/TileView"],function(e){return Tile=Backbone.Model.extend({defaults:{position:{}},initialize:function(){this.tileView=new e({model:this})},select:function(){this.tileView.select()},unselect:function(){this.tileView.unselect()},positionMatch:function(e){return this.get("position").x===e[0]&&this.get("position").y===e[1]},setDraggability:function(e){e?this.tileView.$el.draggable("enable"):this.tileView.$el.draggable("disable")}}),Tile}),define("views/HandSlotView",[],function(){return window.HandSlotView=Backbone.View.extend({tagName:"div",className:"handSlot",events:{click:"placeTile"},placeTile:function(e){var t=this.hand.selectedTile;t&&(this.$el.append(t.tileView.$el),this.hand.trigger("tile:handslotmove",t))},initialize:function(e){this.hand=e.hand;var t=this,n=function(e,n){if(!$(this).is(":empty")){n.draggable.animate({left:0,top:0},500);return}t.hand.selectedTile.tileView.$el.appendTo(this).attr("style",null),t.hand.trigger("tile:handslotmove",t.hand.selectedTile)};this.$el.droppable({accept:".tile",tolerance:"pointer",addClasses:!1,drop:n})}}),HandSlotView}),define("models/HandSlot",["views/HandSlotView"],function(e){var t=Backbone.Model.extend({initialize:function(t){this.handSlotView=new e({hand:t.hand})}});return t}),define("views/HandView",["models/HandSlot"],function(e){var t=Backbone.View.extend({tagName:"div",className:"hand",initialize:function(e){this.collection=e.collection,this.$el.droppable({accept:".selected",tolerance:"pointer",drop:function(e,t){t.draggable.attr("style",null)}})},events:{},styleTile:function(e){return e.tileView.$el.draggable({revert:"invalid",appendTo:".tileSlot",addClasses:!1}),e.styled=!0,e},render:function(){var t=this;this.$el.empty(),_(this.collection.models.length).times(function(n){var r=new e({hand:t.collection});t.$el.append(r.handSlotView.$el),r.handSlotView.$el.append(t.styleTile(t.collection.models[n]).tileView.$el),t.collection.models[n].tileView.delegateEvents()})},getFirstEmpty:function(){return _.find(_.map(this.$el.find(".handSlot"),function(e){return $(e)}),function(e){return e.is(":empty")})},getMovescoreEl:function(){return $(this.$el.parent()).find(".movescore")}});return t}),define("views/HideHandView",[],function(){var e=Backbone.View.extend({tagName:"input",className:"showHideHand handhelp",events:{click:"toggleVisibility"},initialize:function(e){this.hand=e.hand,this.$el.attr("type","button"),this.setHandVisibility(this.hand,this.hand.visible)},toggleVisibility:function(){var e=this.$el.parent().find(".hand");this.hand.visible=!this.hand.visible,this.setHandVisibility(this.hand,this.hand.visible)},setHandVisibility:function(e,t){t?(e.handView.$el.show(),this.$el.attr("value","hide")):(e.handView.$el.hide(),this.$el.attr("value","show"))}});return e}),define("models/Hand",["models/Tile","views/HandView","views/HideHandView"],function(e,t,n){var r=Backbone.Collection.extend({model:e,initialize:function(){this.handView=new t({collection:this}),this.visibilityControl=new n({hand:this}),this.visible=!1,this.handView.$el.hide(),this.selectedTile=null},setVisibility:function(e){this.visible=e,this.visibilityControl.setHandVisibility(this,e)},grabTiles:function(e,t,n){return n&&(this.remove(n),e.add(n)),_(t).times(function(t){this.grabTile(e)},this),this},selectTile:function(e){this.selectedTile&&this.selectedTile.unselect(),this.selectedTile=e,e.select()},grabTile:function(e){this.push(e.pop())},endTurn:function(e){return _.each(e,function(e){e.unselect()}),_.each(e,function(e){e.setDraggability(!1)}),this.remove(e),this},updateCurrentMoveScore:function(e){console.log("updating: "+e);if(e){var t=this.handView.getMovescoreEl();t.show(),t.text("+"+e)}else $(this.handView.getMovescoreEl()).hide();return this}});return r}),define("views/PlayerPanelView",[],function(){var e=Backbone.View.extend({tagName:"div",className:"playerPanel",initialize:function(e){this.$el.append(e.hand.handView.$el);var t=e.hand.visibilityControl;this.$el.append(t.$el),this.$el.append("<span class='handscore handhelp'>0</span>"),this.$el.append("<span class='movescore handhelp' style='display:none'>0</span>")}});return e}),define("models/Grabbag",["models/Tile"],function(e){var t=Backbone.Collection.extend({model:e,initialize:function(e){this.shuffle()},initTiles:function(e){this.add(_.shuffle(_.flatten(_.map(e,this.getTiles))))},getTiles:function(t){var n=[];return _(t.count).times(function(r){n.push(new e({letter:t.letter,points:t.points}))}),n}});return t}),define("app",["models/WordslingerGame","models/Board","views/BoardView","models/Hand","views/PlayerPanelView","models/Grabbag"],function(e,t,n,r,i,s){return{start:function(){var o=[{letter:"A",points:1,count:9},{letter:"B",points:3,count:2},{letter:"C",points:3,count:2},{letter:"D",points:1,count:5},{letter:"E",points:1,count:12},{letter:"F",points:4,count:2},{letter:"G",points:1,count:5},{letter:"H",points:4,count:2},{letter:"I",points:1,count:9},{letter:"J",points:8,count:1},{letter:"K",points:5,count:1},{letter:"L",points:1,count:4},{letter:"M",points:3,count:2},{letter:"N",points:1,count:6},{letter:"O",points:1,count:8},{letter:"P",points:3,count:2},{letter:"Q",points:10,count:1},{letter:"R",points:1,count:6},{letter:"S",points:1,count:4},{letter:"T",points:1,count:6},{letter:"U",points:1,count:4},{letter:"V",points:4,count:2},{letter:"W",points:4,count:2},{letter:"X",points:8,count:1},{letter:"Y",points:4,count:2},{letter:"Z",points:10,count:1},{letter:"",points:0,count:2}],u=function(e){return new i({hand:e})},a=new r,f=new r;$("div.players").append(u(a).$el).append(u(f).$el);var l=new s;l.initTiles(o);var c=new t({hands:[a,f],grabbag:l}),h=new n({model:c,height:15,width:15,$el:$("#board1")}),p=new e({board:c,grabbag:l});p.startGame()}}}),require.config({}),require(["app"],function(e){e.start()}),define("main",function(){})